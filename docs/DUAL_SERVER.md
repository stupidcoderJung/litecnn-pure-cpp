# ë“€ì–¼ ì„œë²„ ì•„í‚¤í…ì²˜ ğŸ”¬

AS-IS (í”„ë¡œë•ì…˜)ì™€ TO-BE (ì‹¤í—˜) ëª¨ë¸ì„ ë™ì‹œì— ìš´ì˜í•˜ëŠ” ë“€ì–¼ ì„œë²„ êµ¬ì¡°ì…ë‹ˆë‹¤.

## ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  M1 MacBook Air (ë¡œì»¬)                                      â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  í¬íŠ¸ 8891 (AS-IS - í”„ë¡œë•ì…˜) ğŸ“Š                      â”‚  â”‚
â”‚  â”‚  â”œâ”€ weights/model_8891.bin                           â”‚  â”‚
â”‚  â”‚  â”œâ”€ ìˆ˜ë™ ë°°í¬ (ì•ˆì • ë²„ì „)                            â”‚  â”‚
â”‚  â”‚  â”œâ”€ ì‹¤ì œ ì„œë¹„ìŠ¤ìš©                                    â”‚  â”‚
â”‚  â”‚  â””â”€ ë©”ëª¨ë¦¬: ~7MB                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  í¬íŠ¸ 8892 (TO-BE - ì‹¤í—˜) ğŸ”¬                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ weights/model_8892.bin                           â”‚  â”‚
â”‚  â”‚  â”œâ”€ ìë™ ë°°í¬ (GPU ì„œë²„ í•™ìŠµ ì™„ë£Œ ì‹œ)               â”‚  â”‚
â”‚  â”‚  â”œâ”€ í…ŒìŠ¤íŠ¸ & ë¹„êµìš©                                  â”‚  â”‚
â”‚  â”‚  â”œâ”€ head/input/í•˜ì´í¼íŒŒë¼ë¯¸í„° ë³€ê²½ ê°€ëŠ¥             â”‚  â”‚
â”‚  â”‚  â””â”€ ë©”ëª¨ë¦¬: ~7MB                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ì„œë²„ ê´€ë¦¬

### ì „ì²´ ì„œë²„ ì œì–´

```bash
# ëª¨ë“  ì„œë²„ ì‹œì‘
./scripts/server_manager.sh start all

# ëª¨ë“  ì„œë²„ ì¤‘ì§€
./scripts/server_manager.sh stop all

# ëª¨ë“  ì„œë²„ ì¬ì‹œì‘
./scripts/server_manager.sh restart all

# ìƒíƒœ í™•ì¸
./scripts/server_manager.sh status
```

### ê°œë³„ ì„œë²„ ì œì–´

```bash
# AS-IS ì„œë²„ë§Œ ì¬ì‹œì‘
./scripts/server_manager.sh restart 8891

# TO-BE ì„œë²„ë§Œ ì¤‘ì§€
./scripts/server_manager.sh stop 8892

# TO-BE ì„œë²„ë§Œ ì‹œì‘
./scripts/server_manager.sh start 8892
```

## ìë™ ë°°í¬ (TO-BE ì „ìš©)

GPU ì„œë²„ì—ì„œ í•™ìŠµ ì™„ë£Œ ì‹œ **TO-BE (8892) ì„œë²„ë§Œ** ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.

### ìˆ˜ë™ ë°°í¬

```bash
cd ~/projects/litecnn-pure-cpp
./scripts/deploy_from_gpu.sh
```

ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ”:
1. GPU ì„œë²„ì—ì„œ ìµœì‹  ì²´í¬í¬ì¸íŠ¸ ë‹¤ìš´ë¡œë“œ
2. `weights/model_8892.bin`ìœ¼ë¡œ ë³€í™˜
3. 8892 í¬íŠ¸ ì„œë²„ ì¬ì‹œì‘
4. **8891 í¬íŠ¸ëŠ” ê±´ë“œë¦¬ì§€ ì•ŠìŒ**

### ìë™ ë°°í¬ (Cron)

30ë¶„ë§ˆë‹¤ GPU ì„œë²„ ì²´í¬ í›„ ë³€ê²½ ê°ì§€ ì‹œ ìë™ ë°°í¬:

```bash
# macOS launchd ë“±ë¡
cat > ~/Library/LaunchAgents/com.litecnn.autodeploy.plist << 'EOF'
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>Label</key>
    <string>com.litecnn.autodeploy</string>
    <key>ProgramArguments</key>
    <array>
        <string>/bin/bash</string>
        <string>/Users/young/projects/litecnn-pure-cpp/scripts/watch_and_deploy.sh</string>
    </array>
    <key>StartInterval</key>
    <integer>1800</integer>
    <key>RunAtLoad</key>
    <true/>
    <key>StandardOutPath</key>
    <string>/tmp/litecnn-autodeploy.log</string>
    <key>StandardErrorPath</key>
    <string>/tmp/litecnn-autodeploy-error.log</string>
</dict>
</plist>
EOF

launchctl load ~/Library/LaunchAgents/com.litecnn.autodeploy.plist
launchctl start com.litecnn.autodeploy
```

## A/B ë¹„êµ

ë‘ ëª¨ë¸ì˜ ì„±ëŠ¥ì„ ì‰½ê²Œ ë¹„êµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ê°„ë‹¨í•œ ë¹„êµ

```bash
# AS-IS
curl -X POST http://localhost:8891/predict \
  -F "image=@test.jpg" | jq '.predictions[0]'

# TO-BE
curl -X POST http://localhost:8892/predict \
  -F "image=@test.jpg" | jq '.predictions[0]'
```

### ë°°ì¹˜ ë¹„êµ ìŠ¤í¬ë¦½íŠ¸

```bash
#!/bin/bash
# ì—¬ëŸ¬ ì´ë¯¸ì§€ë¡œ A/B í…ŒìŠ¤íŠ¸

for img in test_images/*.jpg; do
    echo "Testing: $img"
    
    echo "  AS-IS (8891):"
    curl -s -X POST http://localhost:8891/predict \
      -F "image=@$img" | jq -r '.predictions[0] | "\(.breed_ko) (\(.score))"'
    
    echo "  TO-BE (8892):"
    curl -s -X POST http://localhost:8892/predict \
      -F "image=@$img" | jq -r '.predictions[0] | "\(.breed_ko) (\(.score))"'
    
    echo ""
done
```

## ê°€ì¤‘ì¹˜ íŒŒì¼ ê´€ë¦¬

### AS-IS (8891) ì—…ë°ì´íŠ¸

ìˆ˜ë™ìœ¼ë¡œë§Œ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤ (í”„ë¡œë•ì…˜ ì•ˆì •ì„± ë³´ì¥):

```bash
# 1. ìƒˆ ê°€ì¤‘ì¹˜ ì¤€ë¹„
cp new_stable_model.bin ~/projects/litecnn-pure-cpp/weights/model_8891.bin

# 2. AS-IS ì„œë²„ ì¬ì‹œì‘
cd ~/projects/litecnn-pure-cpp
./scripts/server_manager.sh restart 8891
```

### TO-BE (8892) ì—…ë°ì´íŠ¸

ìë™ ë°°í¬ ë˜ëŠ” ìˆ˜ë™:

```bash
# ìë™: watch_and_deploy.shê°€ ì£¼ê¸°ì ìœ¼ë¡œ ì‹¤í–‰
# ìˆ˜ë™: deploy_from_gpu.sh ì‹¤í–‰
./scripts/deploy_from_gpu.sh
```

## ëª¨ë‹ˆí„°ë§

### ì‹¤ì‹œê°„ ë¡œê·¸

```bash
# AS-IS ë¡œê·¸
tail -f /tmp/litecnn_server_8891.log

# TO-BE ë¡œê·¸
tail -f /tmp/litecnn_server_8892.log

# ìë™ ë°°í¬ ë¡œê·¸
tail -f /tmp/litecnn-autodeploy.log
```

### ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰

```bash
ps aux | grep litecnn_server | grep -v grep
```

### ì„±ëŠ¥ ë¹„êµ

```bash
# ì‘ë‹µì‹œê°„ ì¸¡ì •
echo "AS-IS (8891):"
time curl -s -X POST http://localhost:8891/predict \
  -F "image=@test.jpg" > /dev/null

echo "TO-BE (8892):"
time curl -s -X POST http://localhost:8892/predict \
  -F "image=@test.jpg" > /dev/null
```

## ë°°í¬ í”„ë¡œì„¸ìŠ¤

### AS-IS â†’ TO-BE ìŠ¹ê²©

TO-BE ëª¨ë¸ì´ ì¶©ë¶„íˆ ê²€ì¦ë˜ë©´ AS-ISë¡œ ìŠ¹ê²©:

```bash
# 1. TO-BE ê°€ì¤‘ì¹˜ë¥¼ AS-ISë¡œ ë³µì‚¬
cp weights/model_8892.bin weights/model_8891.bin

# 2. AS-IS ì„œë²„ ì¬ì‹œì‘
./scripts/server_manager.sh restart 8891

# 3. ë²„ì „ íƒœê¹… (ì„ íƒì‚¬í•­)
git tag -a v1.0.0 -m "Promote TO-BE to AS-IS"
git push origin v1.0.0
```

### TO-BE ë¡¤ë°±

ë¬¸ì œ ë°œìƒ ì‹œ ì´ì „ ë²„ì „ìœ¼ë¡œ ë¡¤ë°±:

```bash
# 1. ë°±ì—…ì—ì„œ ë³µêµ¬
cp weights/model_8892.backup.bin weights/model_8892.bin

# 2. TO-BE ì„œë²„ ì¬ì‹œì‘
./scripts/server_manager.sh restart 8892
```

## ìƒíƒœ íŒŒì¼

### ë°°í¬ ì´ë ¥

```bash
# ë§ˆì§€ë§‰ ë°°í¬ëœ TO-BE ëª¨ë¸ í•´ì‹œ
cat ~/.litecnn_last_deploy.txt
```

### ë²„ì „ ê´€ë¦¬

```bash
# í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ëª¨ë¸ ì •ë³´
./scripts/server_manager.sh status
```

## ë¬¸ì œ í•´ê²°

### í¬íŠ¸ ì¶©ëŒ

```bash
# í¬íŠ¸ ì‚¬ìš© í™•ì¸
lsof -i :8891
lsof -i :8892

# ê°•ì œ ì¢…ë£Œ
pkill -9 -f "litecnn_server.*8891"
pkill -9 -f "litecnn_server.*8892"
```

### ë©”ëª¨ë¦¬ ë¶€ì¡±

```bash
# í•œ ì„œë²„ë§Œ ì‹¤í–‰
./scripts/server_manager.sh stop 8892  # TO-BE ì¤‘ì§€
```

### ê°€ì¤‘ì¹˜ íŒŒì¼ ì†ìƒ

```bash
# íŒŒì¼ í¬ê¸° í™•ì¸
ls -lh weights/*.bin

# ì¬ë‹¤ìš´ë¡œë“œ
./scripts/deploy_from_gpu.sh
```

## ë³´ì•ˆ

âš ï¸ **í˜„ì¬ êµ¬ì„±ì€ ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ ì „ìš©ì…ë‹ˆë‹¤**

í”„ë¡œë•ì…˜ ë°°í¬ ì‹œ ì¶”ê°€ í•„ìš”:
- HTTPS/TLS ì¸ì¦ì„œ
- API í† í° ì¸ì¦
- Rate limiting
- ë°©í™”ë²½ ê·œì¹™

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2026-02-06  
**ì‘ì„±ì**: í…”ë¦¬í¬ë¡œ ğŸ–¤
