# A/B í…ŒìŠ¤íŠ¸ & ìë™ ìŠ¹ê²© ğŸ“Š

AS-IS (8891) vs TO-BE (8892) ì„±ëŠ¥ ë¹„êµ ë° ìë™ ìŠ¹ê²© ì‹œìŠ¤í…œ ë¬¸ì„œì…ë‹ˆë‹¤.

## ğŸ¯ ê°œìš”

TO-BE ì„œë²„ì— ìƒˆ ëª¨ë¸ì´ ë°°í¬ë˜ë©´, A/B í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ ì„±ëŠ¥ì„ ë¹„êµí•˜ê³   
ì¡°ê±´ì„ ë§Œì¡±í•˜ë©´ ìë™ìœ¼ë¡œ AS-ISë¡œ ìŠ¹ê²©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸ“Š A/B í…ŒìŠ¤íŠ¸

### ê¸°ë³¸ í…ŒìŠ¤íŠ¸

```bash
cd ~/projects/litecnn-pure-cpp

# A/B í…ŒìŠ¤íŠ¸ ì‹¤í–‰
./scripts/ab_test_v2.sh

# Discord ì•Œë¦¼ í¬í•¨
./scripts/ab_test_v2.sh --notify
```

**ì¶œë ¥ ì˜ˆì‹œ**:
```
=== ğŸ“Š A/B í…ŒìŠ¤íŠ¸ ê²°ê³¼ ===

ì´ ì´ë¯¸ì§€: 100 ê°œ

AS-IS (8891):
  ì •í™•ë„: 85.00% (85/100)
  í‰ê·  ì‘ë‹µì‹œê°„: 234.2ms

TO-BE (8892):
  ì •í™•ë„: 87.00% (87/100)
  í‰ê·  ì‘ë‹µì‹œê°„: 229.1ms

ğŸ† ìŠ¹ì: TO-BE ğŸ† (ì •í™•ë„ 87.00% > 85.00%)
```

### ë¦¬í¬íŠ¸

í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ ë§ˆí¬ë‹¤ìš´ ë¦¬í¬íŠ¸ê°€ ìƒì„±ë©ë‹ˆë‹¤:

- ìœ„ì¹˜: `/tmp/ab_test_report_YYYYMMDD_HHMMSS.md`
- ë‚´ìš©: ì´ë¯¸ì§€ë³„ ìƒì„¸ ê²°ê³¼, í†µê³„, ìŠ¹ì íŒì •

## ğŸš€ ìë™ ìŠ¹ê²©

### ì¡°ê±´

TO-BE ëª¨ë¸ì´ ë‹¤ìŒ ì¡°ê±´ì„ ë§Œì¡±í•˜ë©´ AS-ISë¡œ ìŠ¹ê²©:

- **ì •í™•ë„**: TO-BE >= AS-IS
- **ì‘ë‹µì‹œê°„**: íŠ¹ë³„í•œ ì œí•œ ì—†ìŒ (ì •í™•ë„ ìš°ì„ )

### ì‹¤í–‰

```bash
# ì¡°ê±´ í™•ì¸ í›„ ìŠ¹ê²©
./scripts/promote.sh

# ê°•ì œ ìŠ¹ê²© (ì¡°ê±´ ë¬´ì‹œ)
./scripts/promote.sh --force
```

**í”„ë¡œì„¸ìŠ¤**:
1. A/B í…ŒìŠ¤íŠ¸ ìë™ ì‹¤í–‰
2. ìŠ¹ê²© ì¡°ê±´ í™•ì¸
3. AS-IS ëª¨ë¸ ë°±ì—…
4. TO-BE â†’ AS-IS ë³µì‚¬
5. AS-IS ì„œë²„ ì¬ì‹œì‘
6. Discord/Telegram ì•Œë¦¼

### ë°±ì—…

ìŠ¹ê²© ì‹œ ìë™ìœ¼ë¡œ ë°±ì—… ìƒì„±:

- ìœ„ì¹˜: `~/projects/litecnn-pure-cpp/backups/`
- í˜•ì‹: `model_8891_backup_YYYYMMDD_HHMMSS.bin`
- ì¶”ê°€: ë°°í¬ ì •ë³´ JSON

## â®ï¸  ë¡¤ë°±

### ë°±ì—… ëª©ë¡ í™•ì¸

```bash
./scripts/rollback.sh
```

ì¶œë ¥:
```
ğŸ’¾ ì‚¬ìš© ê°€ëŠ¥í•œ ë°±ì—… ëª©ë¡:

  [1] model_8891_backup_20260206_092530.bin
      ì‹œê°„: 20260206_092530
      í¬ê¸°: 4.0M

  [2] model_8891_backup_20260206_081045.bin
      ì‹œê°„: 20260206_081045
      í¬ê¸°: 4.0M
```

### ë¡¤ë°± ì‹¤í–‰

```bash
# íŠ¹ì • ë°±ì—…ìœ¼ë¡œ ë¡¤ë°±
./scripts/rollback.sh model_8891_backup_20260206_092530.bin
```

**í”„ë¡œì„¸ìŠ¤**:
1. ë°±ì—… íŒŒì¼ í™•ì¸
2. í˜„ì¬ ëª¨ë¸ ì„ì‹œ ë°±ì—…
3. ë°±ì—… íŒŒì¼ë¡œ ë³µì›
4. AS-IS ì„œë²„ ì¬ì‹œì‘
5. Discord/Telegram ì•Œë¦¼

### ì£¼ì˜ì‚¬í•­

- ë¡¤ë°± ì‹œ í™•ì¸ ë©”ì‹œì§€ í‘œì‹œ (y/N)
- í˜„ì¬ ëª¨ë¸ì€ `before_rollback` ë°±ì—…ìœ¼ë¡œ ìë™ ì €ì¥
- ë¡¤ë°± í›„ì—ë„ ë°±ì—… íŒŒì¼ì€ ìœ ì§€ë¨

## ğŸ§ª í…ŒìŠ¤íŠ¸ì…‹ ì¤€ë¹„

### ThuDogs ìƒ˜í”Œ ë‹¤ìš´ë¡œë“œ

```bash
# GPU ì„œë²„ì—ì„œ í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
./scripts/prepare_testset.sh
```

ê¸°ë³¸ ì„¤ì •:
- í´ë˜ìŠ¤ë‹¹ 5ê°œ ì´ë¯¸ì§€
- ëœë¤ ìƒ˜í”Œë§
- ì €ì¥ ê²½ë¡œ: `test_images/`

### ì»¤ìŠ¤í…€ í…ŒìŠ¤íŠ¸ì…‹

ìˆ˜ë™ìœ¼ë¡œ ì´ë¯¸ì§€ ì¶”ê°€:

```bash
mkdir -p test_images/Border_collie
cp your_image.jpg test_images/Border_collie/
```

**ë””ë ‰í† ë¦¬ êµ¬ì¡°**:
```
test_images/
â”œâ”€â”€ Border_collie/
â”‚   â”œâ”€â”€ image1.jpg
â”‚   â””â”€â”€ image2.jpg
â”œâ”€â”€ Golden_Retriever/
â”‚   â”œâ”€â”€ image1.jpg
â”‚   â””â”€â”€ image2.jpg
â””â”€â”€ ...
```

## ğŸ“ˆ ì›Œí¬í”Œë¡œìš°

### ì „ì²´ í”„ë¡œì„¸ìŠ¤

```
GPU ì„œë²„ í•™ìŠµ ì™„ë£Œ
    â†“
TO-BE ìë™ ë°°í¬ (watch_and_deploy.sh)
    â†“
A/B í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (ab_test_v2.sh)
    â†“
ìŠ¹ê²© ì¡°ê±´ í™•ì¸
    â†“
ì¡°ê±´ ë§Œì¡±? â†’ ìë™ ìŠ¹ê²© (promote.sh)
    â†“
AS-IS ì—…ë°ì´íŠ¸ ì™„ë£Œ
```

### ìˆ˜ë™ ì›Œí¬í”Œë¡œìš°

```bash
# 1. ìƒˆ ëª¨ë¸ì´ TO-BEì— ë°°í¬ë˜ì—ˆëŠ”ì§€ í™•ì¸
./scripts/server_manager.sh status

# 2. A/B í…ŒìŠ¤íŠ¸ ì‹¤í–‰
./scripts/ab_test_v2.sh --notify

# 3. ê²°ê³¼ í™•ì¸ í›„ ìŠ¹ê²© ê²°ì •
./scripts/promote.sh

# 4. ë¬¸ì œ ë°œìƒ ì‹œ ë¡¤ë°±
./scripts/rollback.sh
```

## ğŸ“Š ì„±ëŠ¥ ë©”íŠ¸ë¦­

### ì¸¡ì • í•­ëª©

- **ì •í™•ë„**: Top-1 ì •í™•ë„ (%)
- **ì‘ë‹µì‹œê°„**: í‰ê·  ì‘ë‹µì‹œê°„ (ms)
- **ì–‘ìª½ ì •ë‹µ**: ë‘ ëª¨ë¸ ëª¨ë‘ ì •ë‹µì¸ ê²½ìš°
- **ì–‘ìª½ ì˜¤ë‹µ**: ë‘ ëª¨ë¸ ëª¨ë‘ ì˜¤ë‹µì¸ ê²½ìš°

### ë¦¬í¬íŠ¸ í˜•ì‹

ë§ˆí¬ë‹¤ìš´ í…Œì´ë¸”:

| ì´ë¯¸ì§€ | Ground Truth | AS-IS | TO-BE | AS-IS ì •í™•ë„ | TO-BE ì •í™•ë„ | ì‘ë‹µì‹œê°„ |
|--------|--------------|-------|-------|-------------|-------------|----------|
| dog1.jpg | 12 | ë³´ë” ì½œë¦¬ (12) | ë³´ë” ì½œë¦¬ (12) | âœ… | âœ… | 234ms / 227ms |

## ğŸ”§ ì„¤ì •

### ìŠ¹ê²© ì¡°ê±´ ë³€ê²½

`scripts/promote.sh` ìˆ˜ì •:

```bash
# í˜„ì¬: TO-BE >= AS-IS
if (( $(echo "$to_be_acc >= $as_is_acc" | bc -l) )); then

# ì—„ê²©: TO-BEê°€ AS-ISë³´ë‹¤ 2% ì´ìƒ ë†’ì•„ì•¼ í•¨
if (( $(echo "$to_be_acc >= $as_is_acc + 2.0" | bc -l) )); then
```

### ë°±ì—… ë³´ê´€ ê¸°ê°„

ìë™ ì •ë¦¬ (Cron):

```bash
# 7ì¼ ì´ìƒ ëœ ë°±ì—… ì‚­ì œ
0 2 * * * find ~/projects/litecnn-pure-cpp/backups -name "*.bin" -mtime +7 -delete
```

## ğŸš¨ ë¬¸ì œ í•´ê²°

### A/B í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨

```bash
# ì„œë²„ ìƒíƒœ í™•ì¸
./scripts/server_manager.sh status

# ì„œë²„ ì¬ì‹œì‘
./scripts/server_manager.sh restart all

# ë¡œê·¸ í™•ì¸
tail -f /tmp/litecnn_server_8891.log
tail -f /tmp/litecnn_server_8892.log
```

### Ground Truth ë§¤í•‘ ì‹¤íŒ¨

`breed_classes.json`ê³¼ ë””ë ‰í† ë¦¬ëª…ì´ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸:

```bash
# í´ë˜ìŠ¤ ID ì°¾ê¸°
jq -r 'to_entries[] | select(.value.en | contains("border collie")) | .key' \
  breed_classes.json
```

### ë¡¤ë°± ì‹¤íŒ¨

```bash
# ë°±ì—… íŒŒì¼ í™•ì¸
ls -lh ~/projects/litecnn-pure-cpp/backups/

# ìˆ˜ë™ ë³µì›
cp backups/model_8891_backup_*.bin weights/model_8891.bin
./scripts/server_manager.sh restart 8891
```

---

**ì‘ì„±**: í…”ë¦¬í¬ë¡œ ğŸ–¤  
**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2026-02-06  
**ìƒíƒœ**: Phase 2 ì™„ë£Œ âœ…
